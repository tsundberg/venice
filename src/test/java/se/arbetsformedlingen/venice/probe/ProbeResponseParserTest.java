package se.arbetsformedlingen.venice.probe;

import org.junit.Test;
import se.arbetsformedlingen.venice.common.Application;
import se.arbetsformedlingen.venice.common.Host;
import se.arbetsformedlingen.venice.common.Status;
import se.arbetsformedlingen.venice.common.Version;

import static org.assertj.core.api.AssertionsForClassTypes.assertThat;

public class ProbeResponseParserTest {

    @Test
    public void parse_probe_response() {
        Application application = new Application("gfr");
        Host host = new Host("L7700649.u1.local");
        Version version = new Version("4.6.470");
        Status status = new Status("ERROR");

        ProbeResponse expected = new ProbeResponse(application, host, status, version);

        String sampleJson = getSampleJson();

        ProbeResponse actual = ProbeResponseParser.parse(sampleJson);

        assertThat(actual).isEqualTo(expected);
    }

    private String getSampleJson() {
        return "{\"request\":{\"mbean\":\"af-probe:probe=UgkForetagProbe\",\"type\":\"read\"},\"value\":{\"ProbeStatus\":{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Allvarligt fel rapporterat. Se getProbeStatusList för detaljerad information\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"getProbeStatus\",\"action\":\"Kontakta förvaltningsansvarig alt. se detaljade information i probestatuslist.\",\"details\":\"Allvarligt fel rapporterat. Se getProbeStatusList för detaljerad information\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"ERROR\"},\"ProbeStatusList\":[{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar att GFR är online\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"PingProbe\",\"action\":\"Ingen åtgärd krävs.\",\"details\":\"Denna probe kontrollerar att GFR är online\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe hämtar versioninformation om aktuell applikation.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"VersionProbe\",\"action\":\"Om proben rapporterar fel, säkerställ att datakällan är korrekt konfigurerad och att Oracle är online.\",\"details\":\"Denna probe hämtar versioninformation om aktuell applikation.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om Bisnodes kreditjänst är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"BisnodeCreditServiceProbe\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om Bisnodes kreditjänst är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om Bisnodes faktatjänst är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"BisnodeFactServiceProbe\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om Bisnodes faktatjänst är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om AFs sftpserver är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckAFSFTPService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om AFs sftpserver är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om datalagrets ftpserver är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"AFDatalagerSFTPService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om datalagrets ftpserver är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om AFs backendserver är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckAFBackendService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om AFs backendserver är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om ftpserver för postnummer är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckAFSFTPPostnummerService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om ftpserver för postnummer är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om Businesschecks ftpserver är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckBusinessCheckFTPService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om Businesschecks ftpserver är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om AMQ är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckJMSService\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om AMQ är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean kan skapas för datalagerjobbet.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckDatalagerTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean kan skapas för datalagerjobbet.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean för varnings och näringsförbudsfiler finns.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckBusinesscheckTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean för varnings och näringsförbudsfiler finns.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean för postnummerimporten finns.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckPostnummerTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean för postnummerimporten finns.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean för filexport finns.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckFilexportTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean för filexport finns.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean för filimport finns.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckFilimportTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean för filimport finns.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om temparean för parsade filer (filimport) finns.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckFilimportParsedTempArea\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om temparean för parsade filer (filimport) finns.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar om databasen är online.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckDBConnection\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar om databasen är online.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar status för importjobbet.\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckLastImport\",\"action\":\"Ingen action\",\"details\":\"Denna probe kontrollerar status för importjobbet.\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"OK\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar senaste postnummerjobbet\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckLastPostnrImport\",\"action\":\"Postnummer har inte uppdaterats på 35 dagar. Kontakta GFR Förvaltning för felsökning\",\"details\":\"Denna probe kontrollerar senaste postnummerjobbet\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"ERROR\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar senaste import av arbetsgivardeklarationer\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckLastArbetsgivarDeklarationImport\",\"action\":\"Arbetsgivarimport har inte genomförts på 20 dagar. Kontakta GFR Förvaltning.\",\"details\":\"Denna probe kontrollerar senaste import av arbetsgivardeklarationer\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"ERROR\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar senaste export till Datalager\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckLastDatalagerExport\",\"action\":\"Datalagerexport av arbetsställen har inte skett på 3 dag\\/dagar och för företag på 3 dag\\/dagar Kontakta GFR Förvaltning för felsökning.\",\"details\":\"Denna probe kontrollerar senaste export till Datalager\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"ERROR\"},{\"applicationVersion\":\"4.6.470\",\"applicationBuildDate\":\"2017-02-13 03:34\",\"hostip\":\"172.16.36.88\",\"fqdn\":\"L7700649.u1.local\",\"message\":\"Denna probe kontrollerar import av varnings- och näringsförbudsinformation\",\"applicationBuildJava\":\"1.8.0_71\",\"application\":\"gfr\",\"applicationBuildOS\":\"Linux\",\"jbossInstance\":\"l7700649\",\"applicationBuildMaven\":\"3.2.2\",\"name\":\"CheckLastBusinesscheckImport\",\"action\":\"Varnings- och näringsförbudsmport har inte genomförts på 34 dagar. Kontakta GFR Förvaltning.\",\"details\":\"Denna probe kontrollerar import av varnings- och näringsförbudsinformation\",\"applicationBuildUser\":\"jenkins-slave\",\"status\":\"ERROR\"}]},\"timestamp\":1486971782,\"status\":200}";
    }
}
